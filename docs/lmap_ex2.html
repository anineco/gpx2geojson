<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Leaflet版ルート地図</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin="">
<style>
body {
  margin: 0;
}
#map {
  width: 640px;
  height: 480px;
}
.leaflet-popup h2 {
  margin: 0;
  padding: 0 2em 0 0;
  font-size: 12px;
  font-weight: bold;
  color: red;
}
.leaflet-popup td {
  font-size: 12px;
  padding: 0;
}
.leaflet-popup td:first-child {
  padding-right: 1em;
  color: blue;
}
.leaflet-tooltip {
  margin: 0;
  padding: 0;
  background-color: rgba(255,255,255,0.5);
  color: blue;
}
</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  crossorigin=""></script>
<script>
var param = {
  lon: 138.723460, lat: 35.931374, zoom: 13,
  url: 'example/routemap.geojson'
};
window.addEventListener('DOMContentLoaded', function() {
  var map = L.map('map', {
    center: [param.lat, param.lon],
    zoom: param.zoom
  });
  var std = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
    attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>'
  }).addTo(map);
  var pale = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {
    attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>'
  });
  var ort = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg', {
    attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>'
  });
  var osm = L.tileLayer('https://tile.openstreetmap.jp/{z}/{x}/{y}.png', {
    attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  });

  var xhr = new XMLHttpRequest();
  xhr.responseType = 'json';
  xhr.addEventListener('loadend', function (e) {
    if (this.status !== 200) {
      return;
    }
    var track = L.geoJSON(this.response, {
      pointToLayer: function (feature, latlng) {
        return L.marker(latlng, {
          icon: L.icon({
            iconUrl: feature.properties._iconUrl,
            iconSize: feature.properties._iconSize,
            iconAnchor: feature.properties._iconAnchor
          })
        }).bindTooltip(feature.properties.name, {
          permanent: true,
          direction: 'left',
          offset: L.point(-15,0),
          opacity: 0.8
        });
      },
      style: function (feature) {
        return {
          color: feature.properties._color,
          weight: feature.properties._weight,
          opacity: feature.properties._opacity,
          dashArray: feature.properties._dashArray
        };
      }
    }).bindPopup(function (layer) {
      var properties = layer.feature.properties;
      var html = '<h2>' + properties.name + '</h2>';
      var keys = Object.keys(properties).filter(function (key) {
        return key !== 'geometry' && key !== 'name' && key.substr(0, 1) !== '_';
      });
      if (keys.length > 0) {
        html = html + '<table><tbody>' + keys.map(function (key) {
          return '<tr><td>' + key + '</td><td>' + properties[key] + '</td></tr>';
        }) + '</tbody></table>';
      }
      return html;
    }).addTo(map);
    L.control.layers(
      { '標準地図': std, '淡色地図': pale, '写真': ort, 'OSM': osm },
      { 'GPSデータ': track }
    ).addTo(map);
  });
  xhr.open('GET', param.url);
  xhr.send();

  L.control.scale({ imperial: false, metric: true }).addTo(map);
});
</script>
</body>
</html>
